<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–∞</title>
    <style>
        /* ========================================================== */
        /* –°—Ç–∏–ª–∏, –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ "The Golden Spoon" */
        /* ========================================================== */
        :root {
            /* –û–ª–∏–≤–∫–æ–≤–æ-–∑–æ–ª–æ—Ç–∞—è –≥–∞–º–º–∞ –¥–ª—è –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞ */
            --primary-color: #9C9A6F; /* –û—Å–Ω–æ–≤–Ω–æ–π –æ–ª–∏–≤–∫–æ–≤—ã–π */
            --secondary-color: #E2D2B0; /* –°–≤–µ—Ç–ª—ã–π –∑–æ–ª–æ—Ç–∏—Å—Ç—ã–π */
            --bg-dark: #383838; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω */
            --bg-light: #F0F0F0; /* –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω (–¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤) */
            --text-main: #FFFFFF;
            --text-dark: #333333;
            --table-free: #606060;
            --table-selected: #9C9A6F;
            --table-booked: #B54646;

            /* Telegram Theme Adaptation */
            color-scheme: dark; /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏–º —Ç–µ–º–Ω—É—é —Å—Ö–µ–º—É –¥–ª—è –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞ */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Times New Roman', serif; /* –ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç */
            background-color: var(--bg-dark);
            color: var(--text-main);
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* ----- –ó–∞–≥–æ–ª–æ–≤–æ–∫ ----- */
        .header-section {
            background-color: #2F3637; /* –¢–µ–º–Ω–æ-–æ–ª–∏–≤–∫–æ–≤—ã–π */
            padding: 20px 0;
            text-align: center;
            color: var(--secondary-color);
        }

        .header-title {
            font-family: 'Brush Script MT', cursive; /* –ò–º–∏—Ç–∞—Ü–∏—è —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ */
            font-size: 32px;
            margin: 0;
            font-weight: normal;
        }

        .header-subtitle {
            font-size: 16px;
            margin-top: 5px;
            letter-spacing: 1px;
            color: var(--secondary-color);
        }

        /* ----- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ (–î–∞—Ç–∞/–í—Ä–µ–º—è/–ì–æ—Å—Ç–∏) ----- */
        .selection-panel {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            background-color: #555555;
            padding: 15px 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .selection-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px;
            cursor: pointer;
            width: 30%;
            text-align: center;
        }

        .selection-icon {
            font-size: 24px;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .selection-label {
            font-size: 12px;
            color: var(--secondary-color);
            text-transform: uppercase;
        }

        .selection-value {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-main);
            margin-top: 2px;
        }

        /* ----- –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ/–û–≤–µ—Ä–ª–µ–π) ----- */
        #booking-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            justify-content: center;
            align-items: center;
        }

        #booking-form {
            background-color: #2F3637;
            border-radius: 12px;
            padding: 20px;
            max-width: 350px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            color: var(--text-main);
            position: relative;
        }

        #closeBookingForm {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            color: var(--secondary-color);
            cursor: pointer;
        }
        
        #booking-form label {
            display: block;
            margin: 8px 0 4px;
            color: var(--secondary-color);
            font-size: 12px;
        }

        #booking-form input,
        #booking-form select {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #333;
            color: var(--text-main);
            font-size: 14px;
            box-sizing: border-box;
        }

        #booking-form input:focus,
        #booking-form select:focus {
            outline: 1px solid var(--secondary-color);
        }

        /* ----- –ö–∞—Ä—Ç–∞ —Å—Ç–æ–ª–æ–≤ (–≥–ª–∞–≤–Ω—ã–π –±–ª–æ–∫) ----- */
        .table-map-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 10px;
        }

        .table-map {
            width: 100%;
            max-width: 350px;
            aspect-ratio: 1.25 / 1; /* –ü—Ä–∏–º–µ—Ä–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –¥–ª—è –∫–∞—Ä—Ç—ã */
            background-color: #555;
            border-radius: 12px;
            position: relative;
            border: 2px solid var(--primary-color);
        }
        
        .table-element {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            font-weight: bold;
            color: var(--text-main);
            box-sizing: border-box;
        }

        .table-round {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--table-free);
            border: 2px solid var(--secondary-color);
        }

        .table-square {
            width: 80px;
            height: 40px;
            border-radius: 6px;
            background-color: var(--table-free);
            border: 2px solid var(--secondary-color);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–Ω—è—Ç—ã—Ö, —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–æ–ª–æ–≤ */
        .table-booked {
            background-color: var(--table-booked) !important;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .table-selected {
            background-color: var(--table-selected);
            border-color: var(--secondary-color);
            box-shadow: 0 0 10px var(--secondary-color);
        }

        /* –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–æ–≤ (–∫–∞–∫ –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–µ) */
        #table-1 { top: 70px; left: 240px; } /* –ö–≤–∞–¥—Ä–∞—Ç 1 */
        #table-2 { top: 70px; left: 145px; } /* –ö–≤–∞–¥—Ä–∞—Ç 2 */
        #table-3 { top: 70px; left: 50px; } /* –ö—Ä—É–≥ 3 */
        #table-4 { top: 180px; left: 240px; } /* –ö–≤–∞–¥—Ä–∞—Ç 4 */
        #table-5 { top: 180px; left: 145px; } /* –ö—Ä—É–≥ 5 */
        #table-6 { top: 180px; left: 50px; } /* –ö—Ä—É–≥ 6 */
        #table-7 { top: 50px; right: 20px; width: 100px; height: 70px; border-radius: 0; } /* –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ Take 7 */
        #table-8 { top: 160px; right: 20px; width: 100px; height: 70px; border-radius: 0; } /* –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ Booth 8 */

        /* ----- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ----- */
        #confirm-btn {
            width: 80%;
            margin: 20px auto 10px;
            padding: 15px;
            background-color: var(--primary-color);
            color: var(--text-main);
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
        }

        #confirm-btn:hover:not(:disabled) {
            background-color: #B2A383;
        }
        
        #confirm-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .confirmation-text {
            text-align: center;
            font-size: 12px;
            color: var(--secondary-color);
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–π —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .grid, h1 { display: none; }
    </style>
</head>
<body>

<div class="header-section">
    <div class="header-title">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –°—Ç–æ–ª–∏–∫</div>
    <div class="header-subtitle">–†–µ—Å—Ç–æ—Ä–∞–Ω "–ó–æ–ª–æ—Ç–∞—è –õ–æ–∂–∫–∞"</div>
</div>

<div class="selection-panel">
    <div class="selection-item" id="date-select-trigger">
        <span class="selection-icon">üìÖ</span>
        <span class="selection-label">–î–∞—Ç–∞</span>
        <span class="selection-value" id="current-date-value">–°–µ–≥–æ–¥–Ω—è, 18 –æ–∫—Ç 2025</span>
    </div>
    <div class="selection-item" id="time-select-trigger">
        <span class="selection-icon">‚è∞</span>
        <span class="selection-label">–í—Ä–µ–º—è</span>
        <span class="selection-value" id="current-time-value">19:00</span>
    </div>
    <div class="selection-item" id="guests-select-trigger">
        <span class="selection-icon">üë•</span>
        <span class="selection-label">–ì–æ—Å—Ç–∏</span>
        <span class="selection-value" id="current-guests-value">2</span>
    </div>
</div>

<div class="table-map-container">
    <div class="table-map" id="table-map">
        <div class="table-element table-square" id="table-1" data-table="1">1</div>
        <div class="table-element table-square" id="table-2" data-table="2">2</div>
        <div class="table-element table-round" id="table-3" data-table="3">3</div>
        <div class="table-element table-square" id="table-4" data-table="4">4</div>
        <div class="table-element table-round" id="table-5" data-table="5">5</div>
        <div class="table-element table-round" id="table-6" data-table="6">6</div>
        <div class="table-element table-square" id="table-7" data-table="7" style="width: 100px; height: 50px; border-radius: 4px;">–°—Ç–æ–ª 7</div>
        <div class="table-element table-square" id="table-8" data-table="8" style="width: 100px; height: 50px; border-radius: 4px;">–°—Ç–æ–ª 8</div>
        
        </div>
    
    <button id="confirm-btn" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å</button>
    <div class="confirmation-text">–í—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram</div>
</div>


<div id="booking-overlay">
    <form id="booking-form">
        <div id="closeBookingForm">&times;</div>
        <h2>–î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        
        <label for="date-modal">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</label>
        <input type="date" id="date-modal" required />
        
        <label for="time-modal">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</label>
        <select id="time-modal" required></select>
        
        <label for="guests-modal">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π</label>
        <input type="number" id="guests-modal" min="1" max="20" value="2" required />
        
        <label for="phone-modal">–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input type="tel" id="phone-modal" placeholder="+7 (XXX) XXX-XX-XX" required />
        
        <button type="submit">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫ <span id="selected-table-modal"></span></button>
        <div id="message"></div>
    </form>
</div>


<div class="grid" style="display: none;">
    </div>
<div id="booking-form-container" style="display: none;">
    </div>


<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    // ==========================================================
    // JS Logic: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
    // ==========================================================
    
    // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
    let user_id = null;
    let user_name = null;
    let botApiUrl = '';
    let selectedTable = null;
    
    // --- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ---
    const dateInputModal = document.getElementById("date-modal");
    const timeSelectModal = document.getElementById("time-modal");
    const guestsInputModal = document.getElementById("guests-modal");
    const phoneInputModal = document.getElementById("phone-modal");
    const confirmBtn = document.getElementById("confirm-btn");
    const bookingOverlay = document.getElementById("booking-overlay");
    const bookingForm = document.getElementById("booking-form");
    const messageDiv = document.getElementById("message");
    
    const dateValueDisplay = document.getElementById("current-date-value");
    const timeValueDisplay = document.getElementById("current-time-value");
    const guestsValueDisplay = document.getElementById("current-guests-value");

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ---
    function getQueryParams() {
        const params = {};
        new URLSearchParams(window.location.search).forEach((value, key) => {
            params[key] = value;
        });
        return params;
    }

    function adaptToTheme() {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–º–Ω—É—é —Å—Ö–µ–º—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞
        document.documentElement.style.setProperty('color-scheme', 'dark');
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —á–∏—Å—Ç—ã–π CSS –≤—ã—à–µ
    }

    window.onload = function() {
        const params = getQueryParams();
        user_id = params.user_id;
        user_name = params.user_name;
        botApiUrl = params.bot_url || "https://readytoearn-4.onrender.com"; // URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        if (window.Telegram && window.Telegram.WebApp) {
            adaptToTheme();
            window.Telegram.WebApp.ready();
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        const now = new Date();
        const todayStr = now.toISOString().slice(0, 10);
        
        dateInputModal.value = todayStr;
        dateValueDisplay.textContent = formatDateForDisplay(now);
        guestsValueDisplay.textContent = guestsInputModal.value;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
        fillTimeSelect(null, todayStr); 
    };

    function formatDateForDisplay(date) {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);

        if (date.toDateString() === today.toDateString()) {
            return "–°–µ–≥–æ–¥–Ω—è, " + date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
        } else if (date.toDateString() === tomorrow.toDateString()) {
            return "–ó–∞–≤—Ç—Ä–∞, " + date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
        } else {
            return date.toLocaleDateString('ru-RU', { weekday: 'short', day: 'numeric', month: 'short' });
        }
    }


    // --- –õ–æ–≥–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞) ---
    function generateAllTimeSlots() {
        const slots = [];
        let start = new Date(); start.setHours(12, 0, 0, 0); // –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
        const end = new Date(); end.setHours(23, 0, 0, 0); // –ö–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã
        while (start <= end) {
            slots.push(start.toTimeString().slice(0, 5));
            start = new Date(start.getTime() + 30 * 60000);
        }
        return slots;
    }

    async function fillTimeSelect(tableId, selectedDate) {
        const select = timeSelectModal;
        select.innerHTML = '';
        select.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º, –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–º –¥–∞–Ω–Ω—ã–µ
        
        const allSlots = generateAllTimeSlots();
        let bookedTimes = [];
        
        if (tableId) {
             try {
                const url = `${botApiUrl}/get_booked_times?table=${tableId}&date=${selectedDate}`;
                const res = await fetch(url);
                const data = await res.json();
                if (data.status === 'ok') {
                    bookedTimes = data.booked_times;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–Ω—è—Ç—ã—Ö –≤—Ä–µ–º–µ–Ω:', error);
            }
        }
        
        const now = new Date();
        const todayDateStr = now.toISOString().slice(0, 10);
        let firstAvailableSlot = null;

        allSlots.forEach(slot => {
            if (!bookedTimes.includes(slot)) {
                let isPast = false;
                if (selectedDate === todayDateStr) {
                    const slotTime = new Date(`${selectedDate}T${slot}:00`);
                    if (slotTime < now) {
                        isPast = true;
                    }
                }
                
                if (!isPast) {
                    const option = document.createElement("option");
                    option.value = slot;
                    option.textContent = slot;
                    select.appendChild(option);
                    
                    if (!firstAvailableSlot) {
                        firstAvailableSlot = slot;
                    }
                }
            }
        });
        
        select.disabled = false;
        if (select.options.length > 0) {
            select.value = firstAvailableSlot;
            timeValueDisplay.textContent = firstAvailableSlot;
        } else {
            timeValueDisplay.textContent = "–ù–µ—Ç –º–µ—Å—Ç";
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Ç–æ–ª–æ–≤, –µ—Å–ª–∏ –¥–∞—Ç–∞/–≤—Ä–µ–º—è –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
        if (!tableId) {
            updateTableAvailability(selectedDate, firstAvailableSlot);
        }
    }
    
    // --- –õ–æ–≥–∏–∫–∞ –∫–∞—Ä—Ç—ã —Å—Ç–æ–ª–æ–≤ ---
    function updateTableAvailability(date, time) {
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –í–°–ï–• –∑–∞–Ω—è—Ç—ã—Ö —Å—Ç–æ–ª–æ–≤ –Ω–∞ –¥–∞—Ç—É/–≤—Ä–µ–º—è.
        // –í–∞—à —Ç–µ–∫—É—â–∏–π –∫–æ–¥ —ç—Ç–æ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å—Ç–æ–ª.
        // –î–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—É, –Ω–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–ª:
        // /get_booked_tables?date=...&time=... -> { "booked_tables": [3, 7] }
        
        // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –¥–∏–∑–∞–π–Ω
        document.querySelectorAll('.table-element').forEach(table => {
            table.classList.remove('table-booked', 'table-selected');
            table.classList.add('table-free');
            
            // –ó–∞–≥–ª—É—à–∫–∞: –î–µ–ª–∞–µ–º —Å—Ç–æ–ª 3 –∏ 7 –∑–∞–Ω—è—Ç—ã–º–∏, –µ—Å–ª–∏ –≤—Ä–µ–º—è 19:00
            if ((table.dataset.table === '3' || table.dataset.table === '7') && time === '19:00') {
                 table.classList.add('table-booked');
                 table.classList.remove('table-free');
            }
        });
        
        // –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –Ω–∞–º–∏ —Å—Ç–æ–ª
        if (selectedTable) {
            const tableElement = document.getElementById(`table-${selectedTable}`);
            if (tableElement.classList.contains('table-booked')) {
                selectedTable = null;
                confirmBtn.disabled = true;
                confirmBtn.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Å—Ç–æ–ª';
            } else {
                tableElement.classList.add('table-selected');
                confirmBtn.disabled = false;
                confirmBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å';
            }
        }
    }

    document.querySelectorAll('.table-element').forEach(table => {
        table.addEventListener('click', (e) => {
            const clickedTable = e.currentTarget.dataset.table;
            
            if (e.currentTarget.classList.contains('table-booked')) {
                messageDiv.textContent = '‚ùå –°—Ç–æ–ª–∏–∫ –∑–∞–Ω—è—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π.';
                messageDiv.style.display = 'block';
                return;
            }
            
            // –°–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞
            if (selectedTable) {
                document.getElementById(`table-${selectedTable}`).classList.remove('table-selected');
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
            selectedTable = clickedTable;
            e.currentTarget.classList.add('table-selected');
            confirmBtn.disabled = false;
            confirmBtn.textContent = `–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª ${selectedTable}`;
            messageDiv.style.display = 'none';
        });
    });

    // --- –õ–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ---
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å"
    confirmBtn.addEventListener('click', () => {
        if (!selectedTable) return;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º
        document.getElementById('selected-table-modal').textContent = selectedTable;
        phoneInputModal.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        bookingOverlay.style.display = 'flex';
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.getElementById("closeBookingForm").addEventListener('click', () => {
        bookingOverlay.style.display = 'none';
    });

    // --- –õ–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏/–≥–æ—Å—Ç–µ–π (–æ–±–Ω–æ–≤–ª—è–µ–º –≥–ª–∞–≤–Ω—ã–π –¥–∏—Å–ø–ª–µ–π) ---
    dateInputModal.addEventListener('change', (e) => {
        const newDate = new Date(e.target.value);
        dateValueDisplay.textContent = formatDateForDisplay(newDate);
        
        // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ª–æ—Ç—ã
        fillTimeSelect(selectedTable, e.target.value);
    });

    timeSelectModal.addEventListener('change', (e) => {
        timeValueDisplay.textContent = e.target.value;
        
        // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å—Ç–æ–ª–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
        updateTableAvailability(dateInputModal.value, e.target.value);
    });

    guestsInputModal.addEventListener('change', (e) => {
        guestsValueDisplay.textContent = e.target.value;
    });


    // --- –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞) ---
    bookingForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        messageDiv.textContent = "";
        messageDiv.style.display = "none";
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ "–ø—Ä–æ—à–µ–¥—à–µ–µ"
        const selectedDateTime = new Date(`${dateInputModal.value}T${timeSelectModal.value}:00`);
        const now = new Date();
        
        if (selectedDateTime < now) {
            messageDiv.textContent = "‚ùå –ù–µ–ª—å–∑—è –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è";
            messageDiv.style.display = "block";
            return;
        }
        
        const data = {
            user_id: user_id,
            user_name: user_name,
            table: selectedTable,
            date: dateInputModal.value,
            time: timeSelectModal.value,
            guests: guestsInputModal.value,
            phone: phoneInputModal.value
        };

        try {
            const res = await fetch(`${botApiUrl}/book`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            
            if (res.ok) {
                messageDiv.textContent = "‚úÖ –°—Ç–æ–ª–∏–∫ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω! –ò—â–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤ Telegram.";
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram –±–æ—Ç—É
                window.Telegram.WebApp.sendData(JSON.stringify(data));
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    bookingOverlay.style.display = "none";
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–æ–ª
                    document.getElementById(`table-${selectedTable}`).classList.remove('table-selected');
                    selectedTable = null;
                    confirmBtn.disabled = true;
                    confirmBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å—Ç–æ–ª –∑–∞–Ω—è—Ç
                    updateTableAvailability(dateInputModal.value, timeSelectModal.value);
                }, 2000);

            } else {
                messageDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å'}`;
            }
            messageDiv.style.display = "block";
        } catch (err) {
            console.error('Fetch error:', err);
            messageDiv.textContent = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.";
            messageDiv.style.display = "block";
        }
    });
</script>
</body>
</html>